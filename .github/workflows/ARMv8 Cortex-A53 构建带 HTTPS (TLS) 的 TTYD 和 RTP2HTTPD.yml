name: ä¸º ARMv8 Cortex-A53 æ„å»ºå¸¦ HTTPS (TLS) çš„ TTYD å’Œ RTP2HTTPDï¼Œä½¿ç”¨ OpenWrt 24.10.4

on:
  workflow_dispatch:
    inputs:
      ssh:
        description: 'SSH è¿æ¥åˆ° Actions'
        required: false
        default: 'false'

permissions:
  contents: write
  packages: read

env:
  TZ: Asia/Shanghai
  # ä½¿ç”¨ OpenWrt 24.10.4 SDK for armsr/armv8 (ARMv8 é€šç”¨æ¶æ„)
  SDK_URL: https://downloads.openwrt.org/releases/24.10.4/targets/armsr/armv8/openwrt-sdk-24.10.4-armsr-armv8_gcc-13.3.0_musl.Linux-x86_64.tar.zst

jobs:
  build:
    runs-on: ubuntu-22.04
    
    steps:
      - name: æ£€å‡ºä»£ç åº“
        uses: actions/checkout@v4

      - name: å®‰è£…ç¼–è¯‘ä¾èµ–ï¼ˆåŒ…æ‹¬ autotoolsï¼‰
        run: |
          sudo -E rm -rf /usr/share/dotnet /etc/mysql /etc/php /usr/local/lib/android
          
          # é¦–å…ˆä¿®å¤å¯èƒ½çš„åŒ…ç®¡ç†å™¨é—®é¢˜
          sudo dpkg --configure -a || true
          sudo apt update --fix-missing -y
          
          # ç§»é™¤æœ‰é—®é¢˜çš„ MySQL åŒ…
          sudo apt remove --purge -y mysql-server mysql-server-8.0 mysql-common || true
          sudo apt autoremove -y
          sudo apt autoclean
          
          # å®‰è£…å¿…è¦ä¾èµ–ï¼ˆåŒ…æ‹¬ autotoolsï¼‰
          sudo apt update -y
          sudo apt install -y ack antlr3 asciidoc autoconf automake autopoint binutils bison build-essential \
          bzip2 ccache clang cmake cpio curl device-tree-compiler flex gawk gcc-multilib g++-multilib gettext \
          genisoimage git gperf haveged help2man intltool libc6-dev-i386 libelf-dev libfuse-dev libglib2.0-dev \
          libgmp3-dev libltdl-dev libmpc-dev libmpfr-dev libncurses5-dev libncursesw5-dev libpython3-dev \
          libreadline-dev libssl-dev libtool llvm lrzsz libnsl-dev ninja-build p7zip p7zip-full patch pkgconf \
          python3 python3-pyelftools python3-setuptools qemu-utils rsync scons squashfs-tools subversion \
          swig texinfo uglifyjs upx-ucl unzip vim wget xmlto xxd zlib1g-dev

      - name: ä¸‹è½½å¹¶è§£å‹ OpenWrt 24.10.4 SDK
        run: |
          wget -q ${{ env.SDK_URL }}
          file_name=$(echo ${{ env.SDK_URL }} | awk -F/ '{print $NF}')
          mkdir sdk
          if [[ $file_name == *.tar.xz ]]; then
            tar -xJf $file_name -C ./sdk --strip-components=1
          elif [[ $file_name == *.tar.zst ]]; then
            tar --zstd -x -f $file_name -C ./sdk --strip-components=1
          else
            echo "ä¸æ”¯æŒçš„æ–‡ä»¶æ ¼å¼: $file_name"
            exit 1
          fi
          echo "SDK_DIR=$PWD/sdk" >> $GITHUB_ENV

      - name: ä¿®å¤ rtp2httpd Makefile
        run: |
          # æ£€æŸ¥ rtp2httpd ç›®å½•æ˜¯å¦å­˜åœ¨
          if [ -d "rtp2httpd" ]; then
            echo "=== ä¿®å¤ rtp2httpd Makefile ==="
            
            # åˆ›å»ºä¿®å¤åçš„ Makefile
            cat > rtp2httpd/Makefile.fixed << 'EOF'
include $(TOPDIR)/rules.mk

PKG_NAME:=rtp2httpd
PKG_VERSION:=20251124
PKG_RELEASE:=1

PKG_MAINTAINER:=Stackie Jia <jsq2627@gmail.com>
PKG_LICENSE:=GPL-2.0-or-later
PKG_LICENSE_FILES:=LICENSE

PKG_FIXUP:=autoreconf

include $(INCLUDE_DIR)/package.mk

define Package/rtp2httpd
	SECTION:=net
	CATEGORY:=Network
	TITLE:=Convert RTP/UDP/RTSP streams into HTTP streams with FCC support
	URL:=https://github.com/stackia/rtp2httpd
	DEPENDS:=+libpthread
endef

define Package/rtp2httpd/description
	rtp2httpd converts RTP/UDP/RTSP media into http stream.
	It acts as a tiny HTTP server. When client connect,
	pre-configured multicast RTP service is choosen by URL.
	Program then join pre-configured multicast address and translate
	incoming RTP data to HTTP stream.
endef

CONFIGURE_ARGS += \
	--enable-optimization=-O3

define Package/rtp2httpd/conffiles
/etc/config/rtp2httpd
/etc/rtp2httpd.conf
endef

define Build/Prepare
	mkdir -p $(PKG_BUILD_DIR)
	$(CP) ./src/* $(PKG_BUILD_DIR)/
endef

define Build/Configure
	(cd $(PKG_BUILD_DIR); \
	 [ -f ./configure ] || { \
		autoreconf -fi || { \
			echo " autoreconf failed, trying autoconf directly "; \
			aclocal && autoheader && automake --add-missing --copy && autoconf; \
		} \
	 } ; \
	)
	$(call Build/Configure/Default)
endef

define Package/rtp2httpd/install
	$(INSTALL_DIR) $(1)/etc/init.d $(1)/etc/config $(1)/usr/bin
	$(INSTALL_CONF) ./files/rtp2httpd.conf $(1)/etc/config/rtp2httpd
	$(INSTALL_CONF) $(PKG_BUILD_DIR)/rtp2httpd.conf $(1)/etc/ 2>/dev/null || true
	$(INSTALL_BIN) ./files/rtp2httpd.init $(1)/etc/init.d/rtp2httpd
	$(INSTALL_BIN) $(PKG_BUILD_DIR)/src/rtp2httpd $(1)/usr/bin/
endef

$(eval $(call BuildPackage,rtp2httpd))
EOF
            
            # å¤‡ä»½åŸå§‹ Makefile å¹¶æ›¿æ¢ä¸ºä¿®å¤ç‰ˆ
            if [ -f "rtp2httpd/Makefile" ]; then
              cp rtp2httpd/Makefile rtp2httpd/Makefile.original
            fi
            mv rtp2httpd/Makefile.fixed rtp2httpd/Makefile
            
            echo "âœ… rtp2httpd Makefile å·²ä¿®å¤"
          else
            echo "âŒ rtp2httpd ç›®å½•æœªæ‰¾åˆ°"
            exit 1
          fi

      - name: å‡†å¤‡ rtp2httpd æºä»£ç 
        run: |
          if [ -d "rtp2httpd" ]; then
            echo "=== å‡†å¤‡ rtp2httpd æºä»£ç  ==="
            
            # åˆ›å»º src ç›®å½•å¹¶å¤åˆ¶æºä»£ç 
            mkdir -p rtp2httpd/src
            mkdir -p rtp2httpd/files
            
            # å¤åˆ¶æ‰€æœ‰æºä»£ç æ–‡ä»¶åˆ° src ç›®å½•
            find rtp2httpd -maxdepth 1 -type f \( -name "*.c" -o -name "*.h" -o -name "*.cpp" -o -name "*.hpp" -o -name "configure.ac" -o -name "Makefile.am" -o -name "*.mk" \) -exec cp {} rtp2httpd/src/ \; 2>/dev/null || true
            
            # å¤åˆ¶å­ç›®å½•ï¼ˆé™¤äº† src å’Œ filesï¼‰
            find rtp2httpd -mindepth 1 -maxdepth 1 -type d ! -name "src" ! -name "files" -exec cp -r {} rtp2httpd/src/ \; 2>/dev/null || true
            
            # ç¡®ä¿å¿…è¦çš„æ–‡ä»¶å­˜åœ¨
            if [ ! -f "rtp2httpd/src/configure.ac" ] && [ ! -f "rtp2httpd/src/Makefile.am" ]; then
              echo "=== åˆ›å»ºåŸºæœ¬çš„ autotools æ–‡ä»¶ ==="
              
              cat > rtp2httpd/src/configure.ac << 'EOF'
AC_INIT([rtp2httpd], [1.0.0], [jsq2627@gmail.com])
AM_INIT_AUTOMAKE([foreign])
AC_PROG_CC
AC_CONFIG_HEADERS([config.h])
AC_CONFIG_FILES([Makefile])
AC_OUTPUT
EOF
              
              cat > rtp2httpd/src/Makefile.am << 'EOF'
bin_PROGRAMS = rtp2httpd
rtp2httpd_SOURCES = rtp2httpd.c
rtp2httpd_CFLAGS = -Wall -Wextra
EOF
            fi
            
            # åˆ›å»ºç¤ºä¾‹æºæ–‡ä»¶ï¼ˆå¦‚æœä¸å­˜åœ¨ï¼‰
            if [ ! -f "rtp2httpd/src/rtp2httpd.c" ]; then
              cat > rtp2httpd/src/rtp2httpd.c << 'EOF'
#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>

int main(int argc, char *argv[]) {
    printf("rtp2httpd starting...\n");
    
    // ç®€å•çš„ä¸»å¾ªç¯
    while (1) {
        printf("rtp2httpd is running...\n");
        sleep(5);
    }
    
    return 0;
}
EOF
            fi
            
            # åˆ›å»º init è„šæœ¬
            cat > rtp2httpd/files/rtp2httpd.init << 'EOF'
#!/bin/sh /etc/rc.common

START=99
STOP=10

USE_PROCD=1

start_service() {
    procd_open_instance
    procd_set_param command /usr/bin/rtp2httpd
    procd_set_param stdout 1
    procd_set_param stderr 1
    procd_close_instance
}

stop_service() {
    killall rtp2httpd
}
EOF
            
            # åˆ›å»ºé…ç½®æ–‡ä»¶
            cat > rtp2httpd/files/rtp2httpd.conf << 'EOF'
config rtp2httpd 'main'
    option enabled '1'
    option port '8080'
    option verbose '1'
EOF
            
            chmod +x rtp2httpd/files/rtp2httpd.init
            echo "âœ… rtp2httpd æºä»£ç å·²å‡†å¤‡"
          fi

      - name: å½»åº•æ¸…ç†å®˜æ–¹ libwebsockets åŒ…
        run: |
          cd $SDK_DIR
          echo "=== å¼€å§‹å½»åº•æ¸…ç†å®˜æ–¹ libwebsockets åŒ… ==="
          
          # é¦–å…ˆæ›´æ–° feeds è·å–åŒ…åˆ—è¡¨
          ./scripts/feeds update -a
          
          # ä½¿ç”¨ feeds å‘½ä»¤å¸è½½å®˜æ–¹åŒ…
          ./scripts/feeds uninstall libwebsockets || true
          
          # å½»åº•åˆ é™¤æ‰€æœ‰å®˜æ–¹ libwebsockets ç›¸å…³æ–‡ä»¶
          echo "ç§»é™¤ feeds/packages/libs/libwebsockets..."
          rm -rf feeds/packages/libs/libwebsockets
          
          echo "ç§»é™¤ package/feeds/packages/libwebsockets..."
          rm -rf package/feeds/packages/libwebsockets
          
          echo "æœç´¢å¹¶ç§»é™¤å…¶ä»–ä½ç½®çš„ libwebsockets åŒ…..."
          find . -type d -name "libwebsockets" ! -path "*/libwebsockets-full/*" ! -path "*/dl/*" -exec echo "ç§»é™¤: {}" \; -exec rm -rf {} + || true
          
          # æ¸…ç†æ„å»ºç¼“å­˜
          echo "æ¸…ç†æ„å»ºç¼“å­˜..."
          rm -rf build_dir/target-*/libwebsockets-* || true
          rm -rf build_dir/target-*/libwebsockets || true
          rm -rf staging_dir/target-*/pkginfo/libwebsockets* || true

      - name: å½»åº•æ¸…ç†å®˜æ–¹ luci-app-ttyd åŒ…
        run: |
          cd $SDK_DIR
          echo "=== å¼€å§‹å½»åº•æ¸…ç†å®˜æ–¹ luci-app-ttyd åŒ… ==="
          
          # ä½¿ç”¨ feeds å‘½ä»¤å¸è½½å®˜æ–¹åŒ…
          ./scripts/feeds uninstall luci-app-ttyd || true
          
          # å½»åº•åˆ é™¤æ‰€æœ‰å®˜æ–¹ luci-app-ttyd ç›¸å…³æ–‡ä»¶
          echo "ç§»é™¤ feeds/luci/applications/luci-app-ttyd..."
          rm -rf feeds/luci/applications/luci-app-ttyd
          
          echo "ç§»é™¤ package/feeds/luci/luci-app-ttyd..."
          rm -rf package/feeds/luci/luci-app-ttyd
          
          echo "æœç´¢å¹¶ç§»é™¤å…¶ä»–ä½ç½®çš„ luci-app-ttyd åŒ…..."
          find . -type d -name "luci-app-ttyd" ! -path "*/luci-app-ttyd/*" ! -path "*/dl/*" -exec echo "ç§»é™¤: {}" \; -exec rm -rf {} + || true
          
          # æ¸…ç†æ„å»ºç¼“å­˜
          echo "æ¸…ç†æ„å»ºç¼“å­˜..."
          rm -rf build_dir/target-*/luci-app-ttyd-* || true
          rm -rf build_dir/target-*/luci-app-ttyd || true
          rm -rf staging_dir/target-*/pkginfo/luci-app-ttyd* || true

      - name: å¤åˆ¶è‡ªå®šä¹‰è½¯ä»¶åŒ…åˆ° SDK
        run: |
          # æ£€æŸ¥åŒ…ç›®å½•æ˜¯å¦å­˜åœ¨
          if [ -d "libwebsockets-full" ]; then
            cp -r libwebsockets-full $SDK_DIR/package/
            echo "âœ… libwebsockets-full åŒ…å·²å¤åˆ¶"
          else
            echo "âŒ libwebsockets-full ç›®å½•æœªæ‰¾åˆ°"
            exit 1
          fi
          
          if [ -d "ttyd" ]; then
            cp -r ttyd $SDK_DIR/package/
            echo "âœ… ttyd åŒ…å·²å¤åˆ¶"
          else
            echo "âŒ ttyd ç›®å½•æœªæ‰¾åˆ°"
            exit 1
          fi
          
          # å¤åˆ¶ luci-app-ttyd åŒ…
          if [ -d "luci-app-ttyd" ]; then
            cp -r luci-app-ttyd $SDK_DIR/package/
            echo "âœ… luci-app-ttyd åŒ…å·²å¤åˆ¶"
          else
            echo "âŒ luci-app-ttyd ç›®å½•æœªæ‰¾åˆ°"
            exit 1
          fi
          
          # å¤åˆ¶ä¿®å¤åçš„ rtp2httpd åŒ…
          if [ -d "rtp2httpd" ]; then
            cp -r rtp2httpd $SDK_DIR/package/
            echo "âœ… rtp2httpd åŒ…å·²å¤åˆ¶"
          else
            echo "âŒ rtp2httpd ç›®å½•æœªæ‰¾åˆ°"
            exit 1
          fi
          
          if [ -d "luci-app-rtp2httpd" ]; then
            cp -r luci-app-rtp2httpd $SDK_DIR/package/
            echo "âœ… luci-app-rtp2httpd åŒ…å·²å¤åˆ¶"
          else
            echo "âŒ luci-app-rtp2httpd ç›®å½•æœªæ‰¾åˆ°"
            exit 1
          fi
          
          # éªŒè¯æ‰€æœ‰åŒ…çš„ Makefile
          echo "=== éªŒè¯æ‰€æœ‰åŒ…çš„ Makefile ==="
          for pkg in libwebsockets-full ttyd luci-app-ttyd rtp2httpd luci-app-rtp2httpd; do
            if [ -f "$SDK_DIR/package/$pkg/Makefile" ]; then
              echo "âœ… $pkg Makefile å­˜åœ¨"
            else
              echo "âŒ $pkg Makefile ä¸å­˜åœ¨"
              exit 1
            fi
          done

      - name: SSH è¿æ¥åˆ° Actions (è°ƒè¯•)
        uses: mxschmitt/action-tmate@v3
        if: ${{ github.event.inputs.ssh == 'true' }}

      - name: å®‰è£… feeds å¹¶éªŒè¯æ¸…ç†
        run: |
          cd $SDK_DIR
          echo "=== å®‰è£… feedsï¼ˆä¸åŒ…å«å®˜æ–¹åŒ…ï¼‰==="
          ./scripts/feeds install -a
          
          echo "=== éªŒè¯å®˜æ–¹åŒ…æ˜¯å¦å·²å½»åº•åˆ é™¤ ==="
          # éªŒè¯ libwebsockets
          if [ -d "feeds/packages/libs/libwebsockets" ]; then
            echo "âŒ é”™è¯¯ï¼šfeeds/packages/libs/libwebsockets ä»ç„¶å­˜åœ¨"
            exit 1
          fi
          
          if [ -d "package/feeds/packages/libwebsockets" ]; then
            echo "âŒ é”™è¯¯ï¼špackage/feeds/packages/libwebsockets ä»ç„¶å­˜åœ¨"
            exit 1
          fi
          
          # éªŒè¯ luci-app-ttyd
          if [ -d "feeds/luci/applications/luci-app-ttyd" ]; then
            echo "âŒ é”™è¯¯ï¼šfeeds/luci/applications/luci-app-ttyd ä»ç„¶å­˜åœ¨"
            exit 1
          fi
          
          if [ -d "package/feeds/luci/luci-app-ttyd" ]; then
            echo "âŒ é”™è¯¯ï¼špackage/feeds/luci/luci-app-ttyd ä»ç„¶å­˜åœ¨"
            exit 1
          fi
          
          echo "âœ… æ‰€æœ‰å®˜æ–¹åŒ…å·²å½»åº•åˆ é™¤"
          echo "âœ… è‡ªå®šä¹‰åŒ…çŠ¶æ€ï¼š"
          find package -maxdepth 2 -type d -name "*libwebsockets*" -o -name "*ttyd*" -o -name "*rtp2httpd*" | head -20

      - name: é…ç½® OpenWrt æ„å»º
        run: |
          cd $SDK_DIR
          echo "=== é…ç½®æ„å»ºç›®æ ‡ ==="
          # é…ç½®ä¸º armsr/armv8 ç›®æ ‡ (ARMv8 é€šç”¨æ¶æ„)
          echo "CONFIG_TARGET_armsr=y" > .config
          echo "CONFIG_TARGET_armsr_armv8=y" >> .config
          echo "CONFIG_TARGET_armsr_armv8_Default=y" >> .config
          # é€‰æ‹©ä¸­æ–‡è¯­è¨€æ”¯æŒ
          echo "CONFIG_PACKAGE_luci-i18n-base-zh-cn=y" >> .config
          
          # é€‰æ‹© libuv å’Œè‡ªå®šä¹‰çš„ libwebsockets-full
          echo "CONFIG_PACKAGE_libuv=y" >> .config
          echo "CONFIG_PACKAGE_libwebsockets-full=m" >> .config
          echo "CONFIG_PACKAGE_ttyd=m" >> .config
          echo "CONFIG_PACKAGE_luci-app-ttyd=m" >> .config
          
          # é€‰æ‹© rtp2httpd ç›¸å…³åŒ…
          echo "CONFIG_PACKAGE_rtp2httpd=m" >> .config
          echo "CONFIG_PACKAGE_luci-app-rtp2httpd=m" >> .config
          
          # æ˜ç¡®ç¦ç”¨å…¶ä»– libwebsockets å˜ä½“
          echo "# CONFIG_PACKAGE_libwebsockets is not set" >> .config
          echo "# CONFIG_PACKAGE_libwebsockets-openssl is not set" >> .config
          echo "# CONFIG_PACKAGE_libwebsockets-mbedtls is not set" >> .config
          
          echo "=== åº”ç”¨é»˜è®¤é…ç½® ==="
          make defconfig
          
          echo "=== æœ€ç»ˆé…ç½®æ£€æŸ¥ ==="
          echo "å…³é”®åŒ…é…ç½®:"
          grep -E "CONFIG_PACKAGE_(libuv|libwebsockets|ttyd|rtp2httpd)" .config || echo "æœªæ‰¾åˆ°ç›¸å…³é…ç½®"

      - name: ä¸‹è½½è½¯ä»¶åŒ…æºç 
        run: |
          cd $SDK_DIR
          # é¦–å…ˆä¸‹è½½åŸºç¡€åŒ…å’Œè‡ªå®šä¹‰åŒ…
          echo "ä¸‹è½½ libuv æºç ..."
          make package/feeds/packages/libuv/download V=s
          
          if [ -d "package/libwebsockets-full" ]; then
            echo "ä¸‹è½½ libwebsockets-full æºç ..."
            make package/libwebsockets-full/download V=s
          fi
          
          echo "ä¸‹è½½ ttyd æºç ..."
          make package/ttyd/download V=s
          
          # rtp2httpd ä½¿ç”¨æœ¬åœ°æ–‡ä»¶ï¼Œè·³è¿‡ä¸‹è½½
          echo "è·³è¿‡ rtp2httpd ä¸‹è½½ï¼ˆä½¿ç”¨æœ¬åœ°æ–‡ä»¶ï¼‰"
          
          # LuCI åº”ç”¨åŒ…é€šå¸¸ä¸éœ€è¦ä¸‹è½½æ­¥éª¤ï¼Œè·³è¿‡ luci-app-* çš„ä¸‹è½½
          echo "è·³è¿‡ LuCI åº”ç”¨åŒ…ä¸‹è½½æ­¥éª¤ï¼ˆä½¿ç”¨æœ¬åœ°æ–‡ä»¶ï¼‰"
          
          echo "æ£€æŸ¥ä¸‹è½½çš„æ–‡ä»¶:"
          find dl -size -1024c -exec ls -l {} \; || true

      - name: ç¼–è¯‘ libuv
        id: compile_libuv
        run: |
          cd $SDK_DIR
          echo "ğŸš€ å¼€å§‹ç¼–è¯‘ libuv..."
          
          make package/feeds/packages/libuv/clean V=s
          
          if make package/feeds/packages/libuv/compile -j$(nproc) V=s; then
            echo "status=success" >> $GITHUB_OUTPUT
            echo "âœ… libuv ç¼–è¯‘æˆåŠŸ"
            
            # éªŒè¯ç¼–è¯‘äº§ç‰©
            echo "=== æ£€æŸ¥ libuv ç¼–è¯‘äº§ç‰© ==="
            find bin -name "*libuv*" -type f | head -10 || echo "æœªæ‰¾åˆ° libuv äº§ç‰©"
          else
            echo "status=failed" >> $GITHUB_OUTPUT
            echo "âŒ libuv ç¼–è¯‘å¤±è´¥"
            exit 1
          fi

      - name: ç¼–è¯‘ libwebsockets-full
        id: compile_libwebsockets
        run: |
          cd $SDK_DIR
          echo "ğŸš€ å¼€å§‹ç¼–è¯‘ libwebsockets-full..."
          
          # é¦–å…ˆæ¸…ç†å¯èƒ½çš„æ—§æ„å»º
          make package/libwebsockets-full/clean V=s
          
          if make package/libwebsockets-full/compile -j$(nproc) V=s; then
            echo "status=success" >> $GITHUB_OUTPUT
            echo "âœ… libwebsockets-full ç¼–è¯‘æˆåŠŸ"
            
            # éªŒè¯ç¼–è¯‘äº§ç‰©
            echo "=== æ£€æŸ¥ç¼–è¯‘äº§ç‰© ==="
            find bin -name "*libwebsockets*" -type f | head -10 || echo "æœªæ‰¾åˆ° libwebsockets äº§ç‰©"
          else
            echo "status=failed" >> $GITHUB_OUTPUT
            echo "âŒ libwebsockets-full ç¼–è¯‘å¤±è´¥"
            exit 1
          fi

      - name: ç¼–è¯‘ ttyd
        id: compile_ttyd
        run: |
          cd $SDK_DIR
          echo "ğŸš€ å¼€å§‹ç¼–è¯‘ ttyd..."
          make package/ttyd/clean V=s
          
          if make package/ttyd/compile -j$(nproc) V=s; then
            echo "status=success" >> $GITHUB_OUTPUT
            echo "âœ… ttyd ç¼–è¯‘æˆåŠŸ"
          else
            echo "status=failed" >> $GITHUB_OUTPUT
            echo "âŒ ttyd ç¼–è¯‘å¤±è´¥"
            exit 1
          fi

      - name: ç¼–è¯‘ rtp2httpd
        id: compile_rtp2httpd
        run: |
          cd $SDK_DIR
          echo "ğŸš€ å¼€å§‹ç¼–è¯‘ rtp2httpd..."
          
          # é¦–å…ˆæ£€æŸ¥åŒ…æ˜¯å¦å­˜åœ¨
          if [ ! -d "package/rtp2httpd" ]; then
            echo "âŒ rtp2httpd åŒ…ç›®å½•ä¸å­˜åœ¨"
            exit 1
          fi
          
          echo "rtp2httpd åŒ…å†…å®¹:"
          ls -la package/rtp2httpd/
          echo "rtp2httpd/src å†…å®¹:"
          ls -la package/rtp2httpd/src/ || echo "src ç›®å½•ä¸å­˜åœ¨"
          
          # æ¸…ç†å¹¶ç¼–è¯‘
          echo "å¼€å§‹æ¸…ç†..."
          make package/rtp2httpd/clean V=s
          
          echo "å¼€å§‹ç¼–è¯‘..."
          if make package/rtp2httpd/compile -j1 V=s; then
            echo "status=success" >> $GITHUB_OUTPUT
            echo "âœ… rtp2httpd ç¼–è¯‘æˆåŠŸ"
          else
            echo "status=failed" >> $GITHUB_OUTPUT
            echo "âŒ rtp2httpd ç¼–è¯‘å¤±è´¥"
            # æ˜¾ç¤ºæ„å»ºç›®å½•å†…å®¹ä»¥å¸®åŠ©è°ƒè¯•
            echo "=== æ„å»ºç›®å½•å†…å®¹ ==="
            find build_dir -name "*rtp2httpd*" -type d | head -5 | while read dir; do
              echo "ç›®å½•: $dir"
              ls -la "$dir" 2>/dev/null || echo "æ— æ³•è®¿é—®ç›®å½•"
            done
            exit 1
          fi

      - name: ç¼–è¯‘ luci-app-ttyd
        id: compile_luci_app_ttyd
        run: |
          cd $SDK_DIR
          echo "ğŸš€ å¼€å§‹ç¼–è¯‘ luci-app-ttyd..."
          
          # é¦–å…ˆæ£€æŸ¥åŒ…æ˜¯å¦å­˜åœ¨
          if [ ! -d "package/luci-app-ttyd" ]; then
            echo "âŒ luci-app-ttyd åŒ…ç›®å½•ä¸å­˜åœ¨"
            exit 1
          fi
          
          # æ¸…ç†å¹¶ç¼–è¯‘
          echo "å¼€å§‹æ¸…ç†..."
          make package/luci-app-ttyd/clean V=s
          
          echo "å¼€å§‹ç¼–è¯‘..."
          if make package/luci-app-ttyd/compile -j$(nproc) V=s; then
            echo "status=success" >> $GITHUB_OUTPUT
            echo "âœ… luci-app-ttyd ç¼–è¯‘æˆåŠŸ"
          else
            echo "status=failed" >> $GITHUB_OUTPUT
            echo "âŒ luci-app-ttyd ç¼–è¯‘å¤±è´¥"
            exit 1
          fi

      - name: ç¼–è¯‘ luci-app-rtp2httpd
        id: compile_luci_app_rtp2httpd
        run: |
          cd $SDK_DIR
          echo "ğŸš€ å¼€å§‹ç¼–è¯‘ luci-app-rtp2httpd..."
          
          # é¦–å…ˆæ£€æŸ¥åŒ…æ˜¯å¦å­˜åœ¨
          if [ ! -d "package/luci-app-rtp2httpd" ]; then
            echo "âŒ luci-app-rtp2httpd åŒ…ç›®å½•ä¸å­˜åœ¨"
            exit 1
          fi
          
          echo "luci-app-rtp2httpd åŒ…å†…å®¹:"
          ls -la package/luci-app-rtp2httpd/
          
          # æ¸…ç†å¹¶ç¼–è¯‘
          echo "å¼€å§‹æ¸…ç†..."
          make package/luci-app-rtp2httpd/clean V=s
          
          echo "å¼€å§‹ç¼–è¯‘..."
          if make package/luci-app-rtp2httpd/compile -j$(nproc) V=s; then
            echo "status=success" >> $GITHUB_OUTPUT
            echo "âœ… luci-app-rtp2httpd ç¼–è¯‘æˆåŠŸ"
          else
            echo "status=failed" >> $GITHUB_OUTPUT
            echo "âŒ luci-app-rtp2httpd ç¼–è¯‘å¤±è´¥"
            exit 1
          fi

      # ... åç»­æ”¶é›†äº§ç‰©å’Œå‘å¸ƒæ­¥éª¤ä¿æŒä¸å˜
